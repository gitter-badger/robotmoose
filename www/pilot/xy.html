<html lang="en">
	<head>
		<!--#include virtual="/sources.html"-->
		<script src="/js/pilot.js"></script>
		<title>RobotMoose - Pilot</title>
	</head>

	<body role="document" onload="pilotReady();">
		<!--#include virtual="/navbar.html"-->
		<p id="p_outputSensors" style="display:none;"></p>

		<div class="container theme-showcase" role="main" style="padding-top: 70px;">
			<div class="page-header">
				<h1>Pilot</h1>
			</div>

			<table>
				<tr>
					<td>
						<div id="pilot_arrows" style="background-color:#808080;position:relative;width:400px;height:400px;" onmousedown="pilot_mouse(event,0)" ondblclick="pilot_mouse(event,2)" ondragstart="pilot_mouse(event,0)" onmouseout="pilot_mouse(event,1)"  onmouseup="pilot_mouse(event,1)" onmousemove="pilot_mouse(event,2)">
							<img src="/images/arrows_hard.png" style="position:absolute;left:0px;top:0px;width:100%;height:100%;pointer-events:none;"/>
							<img id="glow" src="/images/arrows_glow.png" style="position:absolute;left:0px;top:0px;width:100%;height:100%;pointer-events:none;"/>
						</div>
					</td>
					<td style="width:100%;height:100%">
						<!--<div id="video_area" style="width:100%;height:100%">
							<iframe id="video_frame" style="width:100%;height:400px" src=""></iframe>
						</div>-->
						<div id="map_area">
						</div>
					</td>
				</tr>
			</table>

			<div role="tabpanel">
				<ul class="nav nav-tabs" role="tablist">
					<li role="presentation" class="setup"><a href="#setup" aria-controls="setup" role="tab" data-toggle="tab">Setup</a></li>
					<li role="presentation"><a href="#interaction" aria-controls="interaction" role="tab" data-toggle="tab">Interaction</a></li>
					<li role="presentation"><a href="#sensors" aria-controls="sensors" role="tab" data-toggle="tab">Sensors</a></li>
					<li role="presentation"><a href="#robot_health" aria-controls="robot_health" role="tab" data-toggle="tab">Robot Health</a></li>
					<li role="presentation"><a href="#configuration" aria-controls="configuration" role="tab" data-toggle="tab">Configuration</a></li>
					<li role="presentation"><a href="#state_editor" aria-controls="state_editor" role="tab" data-toggle="tab">State Editor</a></li>
				</ul>

				<div class="tab-content">
					<div role="tabpanel" class="tab-pane active" id="setup">
						<!--Robot Name:<input type="text" id="robot_name" rows="1" cols="30" value="layla/uaf"/>!-->
						Robot Name: <input type="text" id="robot_name" rows="1" cols="30" value="demo" onchange="set_robot_name();"/>

						<input value="Video - Gruveo" type="button" onClick="runCmd('video','r'+((new Date()).getTime())); openGruveoVideo()"/><br/>

						RTC video name: <input type="text" id="robot_videoname" rows="1" cols="30" onChange="updateRTCVideo()" value="layla/uaf"/>
						<input value="Video - RTC" type="button" onClick="updateRTCVideo()"/><br/>

						Drive Power: <input type="text" id="robot_power" rows="1" cols="30" value="15"/><br/>

						Pilot Auth: <input type="text" id="robot_auth" rows="1" cols="30" value=""/><br/>
					</div>
					<div role="tabpanel" class="tab-pane" id="interaction">
						Show text: <input type="text" id="robot_showtext" rows="1" cols="30" onChange="runCmd('say',this.value)" value="Hi! "/><br/>

						Play sounds:
							<input value="Beep 1" type="button" onClick="runCmd('play','music/whistle1.mp3')"/>
							<input value="Beep 2" type="button" onClick="runCmd('play','music/whistle2.mp3')"/>
							<input value="Stop" type="button" onClick="runCmd('play','')"/><br/>

						<div id="button_area" style="font-style:italic">
							<table>
								<tr>
									<td>
										Toggle LED<input id="LEDtoggle" value="LED On" type="checkbox" onClick="LEDtoggle()"/>
									</td>
									<td>
										LED Demo <input  id="LEDdemo" value="LED Demo" type="checkbox" onClick="LEDdemo()" disabled/>
									</td>
									<td>
										<input class="color{pickerOnfocus:true}" id="color_picker" onchange = "updateRGB()"/>
									</td>
								</tr>
								<tr>
									<td></td>
									<td></td>
									<td colspan="3">R <input id="LED_red" size="5"/>  G <input id="LED_green" size="5"/>  B <input id="LED_blue" size="5"/>
								</tr>
							</table>
						</div>
					</div>
					<div role="tabpanel" class="tab-pane" id="sensors">
						<div id="tabula_sensors_tree_viewer"></div>
					</div>
					<div role="tabpanel" class="tab-pane" id="state_editor">
					</div> 
					<div role="tabpanel" class="tab-pane" id="robot_health">
						<table>
							<tr>
								<td>
									<p id="p_outputNet"> Network Status</p>
								</td>
							</tr>
							<tr>
								<td>
									<p id="p_outputPilot">Pilot Status</p>
								</td>
							</tr>
						</table>
					</div>
					<div role="tabpanel" class="tab-pane" id="configuration">
						<div id="tabula_config_gui"></div>
					</div>
				</div>

				<div id="status_area" style="font-style:italic;">
					<p id="p_errorout" style="color:red;">ERROR: JavaScript not enabled.</p>
				</div>
			</div>
		</div>

		<script>
			var configurator_gui;
			var sensors_tree_viewer;
			var state_editor;
			function setup()
			{
				var tabula_config_gui=document.getElementById("tabula_config_gui");
				tabula_config_gui.innerHTML="";
				configurator_gui=new config_gui_t(tabula_config_gui,document.getElementById("robot_name").value);

				if(!configurator_gui)
					alert("Could not create tabula configurer!");

				var tabula_sensors_tree_viewer=document.getElementById("tabula_sensors_tree_viewer");
				tabula_sensors_tree_viewer.innerHTML="";
				sensors_tree_viewer=new tree_viewer_t(tabula_sensors_tree_viewer,null);

				if(!sensors_tree_viewer)
					alert("Could not create tabula sensor viewer!");

				setInterval(function()
				{
					if(sensors_tree_viewer&&document.getElementById("p_outputSensors"))
					{
						var data=document.getElementById("p_outputSensors").innerHTML;

						try
						{
							var json=JSON.parse(data);
							sensors_tree_viewer.refresh({sensors:json});
						}
						catch(error)
						{
							console.log("Sensors Interval - "+error);
						}
					}
				},1000);//Fixme:  Make an object for the sensors...instead of an interval...then fix this...
			var state_editor_div=document.getElementById("state_editor");
				//state_editor.innerHTML="";
				state_editor=new state_editor_t(state_editor_div,document.getElementById("robot_name").value);

				if(!state_editor)
					alert("Could not create state editor !");
			}

			function set_robot_name()
			{
				configurator_gui.set_robot_name(document.getElementById("robot_name").value);
			}

			setup();
		</script>
	</body>
</html>

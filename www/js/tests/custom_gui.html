<html lang="en">
	<head>
		<!--#include virtual="/sources.html"-->
		<!--#include virtual="/navbar.html"-->
	</head>
	<body role="document">
		<div style="padding-top: 51px;">
			<div id="gui"></div>
		</div>

		<script type="text/javascript">
			var cloned=false;

			function clone(to,from,setting)
			{
				try
				{
					send_request("GET","/superstar/"+from,setting,"?get",
						function(response)
						{
							try
							{
								send_request("GET","/superstar/"+to,setting,"?set="+response,
									function(response)
									{
										cloned=true;
									},
									function(error)
									{
										cloned=true;
										throw error;
									},
									"application/json");
							}
							catch(error)
							{
								console.log("clone::upload() - "+error);
							}
						},
						function(error)
						{
							cloned=true;
							throw error;
						},
						"application/json");
				}
				catch(error)
				{
					console.log("clone::download() - "+error);
				}
			}

			function clone_reconnect(robot_name)
			{
				if(cloned)
					robot_connect.onconnect(robot_name);
				else
					setTimeout(function(){clone_reconnect(robot_name);},50);
			}












			var global_name=null;
			var div=document.getElementById("gui");

			var robot_clone=null;
			var robot_connect=null;
			var menu=null;
			var gui=null;
			var config_editor=null;
			var state_table=null;












			robot_connect=new modal_connect_t(div);

			if(!robot_connect)
				alert("Could not create robot connect modal!");

			robot_connect.onconnect=function(robot_name)
			{
				if(robot_name)
				{
					global_name=robot_name;
					robot_clone.clone_target=global_name;
					config_editor.download(global_name);
					state_table.download(global_name);
					menu.get_status_area().innerHTML="Connected to \""+global_name+"\"";
					menu.buttons["Robot"].drops["Clone"].enable();
				}
			};











			robot_clone=new modal_clone_t(div);

			if(!robot_clone)
				alert("Could not create robot clone modal!");

			robot_clone.clone_target=global_name;
			robot_clone.onclone=function(robot_name,settings,options)
			{
				console.log(robot_name);

				if(robot_clone.clone_target)
				{
					for(var key in settings)
						clone(robot_name,robot_clone.clone_target,settings[key]);

					var connect_to_clone=false;

					for(var key in options)
					{
						if(options[key]=="connect_to_clone")
							connect_to_clone=true;
					}

					if(connect_to_clone)
						clone_reconnect(robot_name);
				}
			};



















			menu=new robot_menu_t(div);

			if(!menu)
				alert("Could not create robot menu!");

			menu.get_status_area().innerHTML="<font style='color:red;'>Disconnected</font>";

			menu.create_button
			(
				"Robot",
				null,
				"glyphicon glyphicon-cog",
				{
					"Connect":
					{
						onclick:function(){robot_connect.show();},
						glyph:"glyphicon glyphicon-off"
					},
					"Clone":
					{
						onclick:function(){robot_clone.show();},
						glyph:"glyphicon glyphicon-duplicate"
					}
				}
			);

			menu.buttons["Robot"].drops["Clone"].disable();








			gui=new doorways_t(div);

			if(!gui)
				alert("Could not create gui!");

			gui.load([{"title":"Configuration","x":460,"y":240,"active":false,"minimized":false},
				{"title":"States","x":1000,"y":0,"active":true,"minimized":false}]);














			if(!gui.get_window("Configuration"))
				gui.create_window("Configuration",10,0);

			config_editor=new config_editor_t(gui.get_window("Configuration").body.content,global_name);

			if(!config_editor)
				alert("Could not create config editor!");

			config_editor.onrefresh=function(){gui.refresh_windows_m();};
			config_editor.onconfigure=function()
			{
				if(global_name)
					config_editor.upload(global_name);
			}











			if(!gui.get_window("States"))
				gui.create_window("States",0,0);

			state_table=new state_table_t(gui.get_window("States").body.content);
			state_table.onrefresh=function(){gui.refresh_windows_m();};
			state_table.onrun=function()
			{
				if(global_name)
					state_table.upload(global_name);
			}

			if(!state_table)
				alert("Could not create state table!");
		</script>
	</body>
</html>
